using MaxMind.Db;
using System;
using System.Net;
using Newtonsoft.Json; // Install via: Install-Package Newtonsoft.Json

class Program
{
    static void Main()
    {
        string mmdbPath = @"C:\Users\Humam\source\repos\MMDBReader\MMDBReader\Data\GeoLite2-City.mmdb";

        // Array of IP addresses to test
        string[] ipAddresses = {
    "103.229.80.0",
    "103.243.93.0",
    "109.107.155.0",
    "109.127.64.0",
    "109.205.112.0",
    "109.224.0.0",
    "109.230.112.0",
    "109.234.78.0",
    "109.61.4.0",
    "122.102.116.0",
    "128.0.45.0",
    "130.193.128.0",
    "130.255.0.0",
    "130.255.88.0",
    "131.117.224.0",
    "138.124.156.0",
    "144.86.228.0",
    "149.255.192.0",
    "149.255.255.0",
    "151.236.160.0",
    "154.203.152.0",
    "154.203.178.0",
    "154.208.131.0",
    "154.217.86.0",
    "154.220.169.0",
    "154.223.25.0",
    "154.91.141.0",
    "154.93.36.0",
    "154.93.83.0",
    "154.94.105.0",
    "154.95.64.0",
    "156.225.109.0",
    "156.228.10.0",
    "156.228.8.0",
    "156.244.34.0",
    "156.246.172.0",
    "157.167.83.0",
    "159.255.160.0",
    "162.158.205.0",
    "162.158.83.0",
    "164.138.232.0",
    "167.160.5.0",
    "169.224.0.0",
    "172.68.81.0",
    "172.69.100.0",
    "172.69.106.0",
    "172.69.210.0",
    "172.69.245.0",
    "172.69.53.0",
    "172.70.198.0",
    "172.71.137.0",
    "172.71.84.0",
    "176.105.236.0",
    "176.125.255.0",
    "176.222.60.0",
    "176.241.80.0",
    "176.28.72.0",
    "178.210.224.0",
    "178.210.228.0",
    "178.22.32.0",
    "181.215.39.0",
    "185.1.98.0",
    "185.100.20.0",
    "185.101.236.0",
    "185.104.156.0",
    "185.106.28.0",
    "185.112.188.0",
    "185.112.232.0",
    "185.113.104.0",
    "185.117.172.0",
    "185.117.8.0",
    "185.117.98.0",
    "185.118.128.0",
    "185.118.44.0",
    "185.118.8.0",
    "185.118.96.0",
    "185.12.103.0",
    "185.12.24.0",
    "185.120.140.0",
    "185.122.252.0",
    "185.124.148.0",
    "185.126.32.0",
    "185.128.36.0",
    "185.129.4.0",
    "185.133.224.0",
    "185.135.196.0",
    "185.135.68.0",
    "185.136.148.0",
    "185.136.240.0",
    "185.138.120.0",
    "185.14.248.0",
    "185.140.192.0",
    "185.141.8.0",
    "185.143.40.0",
    "185.144.15.0",
    "185.147.100.0",
    "185.155.156.0",
    "185.157.180.0",
    "185.158.20.0",
    "185.16.25.0",
    "185.164.216.0",
    "185.166.24.0",
    "185.170.145.0",
    "185.172.228.0",
    "185.18.224.0",
    "185.180.60.0",
    "185.181.108.0",
    "185.181.52.0",
    "185.184.196.0",
    "185.185.172.0",
    "185.187.204.0",
    "185.187.76.0",
    "185.194.8.0",
    "185.20.196.0",
    "185.20.24.0",
    "185.203.52.0",
    "185.206.124.0",
    "185.206.172.0",
    "185.206.80.0",
    "185.207.12.0",
    "185.21.136.0",
    "185.212.33.0",
    "185.213.47.0",
    "185.216.69.0",
    "185.217.61.0",
    "185.217.76.0",
    "185.217.88.0",
    "185.220.112.0",
    "185.222.20.0",
    "185.227.236.0",
    "185.228.249.0",
    "185.23.152.0",
    "185.230.105.0",
    "185.234.103.0",
    "185.234.244.0",
    "185.235.141.0",
    "185.239.16.0",
    "185.239.176.0",
    "185.239.52.0",
    "185.24.60.0",
    "185.240.16.0",
    "185.243.128.0",
    "185.244.152.0",
    "185.244.176.0",
    "185.247.176.0",
    "185.247.36.0",
    "185.249.159.0",
    "185.253.11.0",
    "185.253.76.0",
    "185.254.12.0",
    "185.254.200.0",
    "185.254.84.0",
    "185.255.44.0",
    "185.27.117.0",
    "185.27.216.0",
    "185.33.45.0",
    "185.34.16.0",
    "185.37.160.0",
    "185.37.88.0",
    "185.38.212.0",
    "185.42.142.0",
    "185.42.192.0",
    "185.47.180.0",
    "185.52.100.0",
    "185.52.116.0",
    "185.53.34.0",
    "185.54.156.0",
    "185.54.164.0",
    "185.55.184.0",
    "185.56.192.0",
    "185.58.12.0",
    "185.63.85.0",
    "185.65.252.0",
    "185.69.4.0",
    "185.72.252.0",
    "185.75.224.0",
    "185.75.96.0",
    "185.76.32.0",
    "185.84.68.0",
    "185.88.24.0",
    "185.89.88.0",
    "185.89.98.0",
    "185.9.68.0",
    "185.90.104.0",
    "185.90.252.0",
    "185.91.16.0",
    "185.95.184.0",
    "185.95.204.0",
    "185.96.160.0",
    "185.98.157.0",
    "185.98.24.0",
    "188.164.64.0",
    "188.164.70.0",
    "188.164.80.0",
    "188.164.84.0",
    "188.72.0.0",
    "188.95.194.0",
    "191.101.86.0",
    "192.161.6.0",
    "192.166.36.0",
    "193.107.14.0",
    "193.161.200.0",
    "193.194.130.0",
    "193.194.142.0",
    "193.219.112.0",
    "193.242.180.0",
    "193.3.137.0",
    "193.30.241.0",
    "193.47.189.0",
    "193.56.135.0",
    "193.58.117.0",
    "194.113.196.0",
    "194.117.56.0",
    "194.127.108.0",
    "194.127.137.0",
    "194.150.166.0",
    "194.153.102.0",
    "194.153.76.0",
    "194.180.40.0",
    "194.31.193.0",
    "194.31.199.0",
    "194.31.220.0",
    "194.31.93.0",
    "194.34.11.0",
    "194.39.110.0",
    "194.39.228.0",
    "194.48.93.0",
    "194.49.87.0",
    "194.53.68.0",
    "194.55.226.0",
    "195.133.220.0",
    "195.62.88.0",
    "195.69.228.0",
    "195.7.8.0",
    "195.85.218.0",
    "195.85.223.0",
    "195.85.226.0",
    "195.85.244.0",
    "198.160.164.0",
    "198.176.116.0",
    "199.74.188.0",
    "2.56.36.0",
    "202.164.192.0",
    "204.154.200.0",
    "209.8.246.0",
    "212.126.96.0",
    "212.23.217.0",
    "212.237.112.0",
    "212.32.82.0",
    "212.5.40.0",
    "212.5.60.0",
    "212.5.62.0",
    "212.95.128.0",
    "213.134.27.0",
    "213.187.137.0",
    "213.198.89.0",
    "213.32.252.0",
    "217.145.228.0",
    "223.25.120.0",
    "23.206.0.0",
    "31.133.80.0",
    "31.133.88.0",
    "31.14.228.0",
    "31.223.185.0",
    "31.24.252.0",
    "31.25.136.0",
    "31.7.80.0",
    "37.156.104.0",
    "37.17.128.0",
    "37.205.112.0",
    "37.236.0.0",
    "37.77.48.0",
    "37.77.64.0",
    "37.98.224.0",
    "38.3.228.0",
    "38.9.120.0",
    "38.9.96.0",
    "43.152.11.0",
    "43.159.75.0",
    "43.159.83.0",
    "43.174.25.0",
    "43.175.147.0",
    "43.175.208.0",
    "43.175.94.0",
    "45.113.239.0",
    "45.128.120.0",
    "45.132.180.0",
    "45.134.240.0",
    "45.139.105.0",
    "45.143.28.0",
    "45.148.92.0",
    "45.151.234.0",
    "45.151.76.0",
    "45.153.116.0",
    "45.157.148.0",
    "45.157.52.0",
    "45.197.103.0",
    "45.197.64.0",
    "45.8.72.0",
    "45.81.144.0",
    "45.82.60.0",
    "45.89.20.0",
    "46.149.96.0",
    "46.161.192.0",
    "46.18.109.0",
    "46.21.251.0",
    "46.243.16.0",
    "46.30.224.0",
    "5.1.104.0",
    "5.10.224.0",
    "5.11.16.0",
    "5.149.96.0",
    "5.175.144.0",
    "5.181.196.0",
    "5.183.151.0",
    "5.62.128.0",
    "5.8.240.0",
    "62.201.192.0",
    "62.3.56.0",
    "62.32.57.0",
    "62.32.61.0",
    "65.20.128.0",
    "77.81.176.0",
    "78.109.224.0",
    "78.109.237.0",
    "78.41.60.0",
    "79.132.194.0",
    "80.76.50.0",
    "81.161.228.0",
    "81.22.32.0",
    "81.25.137.0",
    "81.25.143.0",
    "81.90.16.0",
    "82.129.16.0",
    "82.129.220.0",
    "82.129.23.0",
    "82.199.208.0",
    "82.205.175.0",
    "83.171.204.0",
    "84.38.253.0",
    "85.113.90.0",
    "85.194.196.0",
    "85.194.248.0",
    "85.208.228.0",
    "85.31.40.0",
    "86.105.144.0",
    "86.105.220.0",
    "86.111.144.0",
    "87.120.87.0",
    "87.236.149.0",
    "87.246.40.0",
    "89.33.66.0",
    "89.46.200.0",
    "91.106.32.0",
    "91.142.50.0",
    "91.192.4.0",
    "91.205.229.0",
    "91.205.42.0",
    "91.212.8.0",
    "91.213.191.0",
    "91.217.133.0",
    "91.217.185.0",
    "91.220.41.0",
    "91.239.119.0",
    "92.112.140.0",
    "92.119.60.0",
    "93.115.252.0",
    "93.180.216.0",
    "93.187.32.0",
    "93.191.112.0",
    "93.91.192.0",
    "93.94.48.0",
    "94.176.40.0",
    "94.231.199.0",
    "94.53.68.0",
    "95.159.64.0",
    "95.170.192.0",
    "95.210.177.0",
    "95.210.234.0"
        };


        using (var reader = new Reader(mmdbPath))
        {
            foreach (string ipString in ipAddresses)
            {
                try
                {
                    var ip = IPAddress.Parse(ipString);
                    var record = reader.Find<Dictionary<string, object>>(ip);

                    string cityName = "Unknown";

                    // Check if record exists and has city information
                    if (record != null && record.ContainsKey("city"))
                    {
                        var cityDict = record["city"] as Dictionary<string, object>;
                        if (cityDict != null && cityDict.ContainsKey("names"))
                        {
                            var namesDict = cityDict["names"] as Dictionary<string, object>;
                            if (namesDict != null && namesDict.ContainsKey("en"))
                            {
                                cityName = namesDict["en"]?.ToString() ?? "Unknown";
                            }
                        }
                    }

                    Console.WriteLine($"IP Address: {ipString} -> City: {cityName}");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"IP Address: {ipString} -> Error: {ex.Message}");
                }
            }
        }
    }
}